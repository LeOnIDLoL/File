<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>DropFiles ‚Äî –ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –Ω–∞ —Å–≤–æ—ë–º —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–µ</title>
  <link rel="icon" href="https://fav.farm/üóÇÔ∏è"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { inter: ['Inter','system-ui','sans-serif'] },
          keyframes: {
            fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
            slideUp: { '0%': { transform:'translateY(12px)', opacity:0 }, '100%': { transform:'translateY(0)', opacity:1 } },
            bubbleUp: { '0%': { transform:'translateY(0) scale(1)', opacity:.0 }, '60%':{ opacity:.8 }, '100%': { transform:'translateY(-140%) scale(1.15)', opacity:0 } }
          },
          animation: { fadeIn: 'fadeIn .5s ease-out both', slideUp: 'slideUp .6s ease-out both' }
        }
      }
    };
  </script>
  <style>
    /* -------- Reveal on scroll -------- */
    @keyframes sectionFadeUp { 0%{opacity:0;transform:translateY(24px)} 100%{opacity:1;transform:translateY(0)} }
    .reveal { opacity:0; transform:translateY(24px); transition:opacity .6s ease, transform .6s ease; }
    .reveal.visible { animation: sectionFadeUp .8s ease forwards; }
    /* -------- Section SPA fade switch -------- */
    main { position: relative; }
    main section { display: none; }
    main section.active { display: block; }
    .section-fade { opacity:0; transform:translateY(12px); transition:opacity .4s ease, transform .4s ease; pointer-events:none; position:absolute; inset:0; }
    .section-fade.active { opacity:1; transform:translateY(0); pointer-events:auto; position:relative; }
    /* -------- NAV with animations -------- */
    nav { transition: transform .4s ease, background-color .3s ease, box-shadow .4s ease;
          background-color: rgba(15,23,42,0.7); backdrop-filter: blur(8px);
          border-bottom:1px solid rgba(255,255,255,0.06); box-shadow:0 0 0 rgba(168,85,247,0); }
    nav.nav-hidden{ transform: translateY(-100%); }
    nav.nav-show-glow{ box-shadow: 0 0 20px rgba(168,85,247,0.25); }
    .logo-anim{ display:inline-block; transition: transform .4s ease; }
    .logo-anim:hover{ transform: rotate(-3deg) scale(1.06); }
    .logo-anim svg{ transition: filter .4s ease; }
    .logo-anim:hover svg{ filter: drop-shadow(0 0 8px rgba(168,85,247,0.6)); }
    .nav-btn{ position:relative; padding:.25rem .5rem; transition:color .3s ease; opacity:0; animation:navFadeIn .5s ease forwards; }
    .nav-btn::after{ content:''; position:absolute; left:50%; bottom:-4px; transform:translateX(-50%) scaleX(0); transform-origin:center;
                      width:60%; height:2px; background:linear-gradient(90deg,#8b5cf6,#3b82f6,#22d3ee); border-radius:2px; transition:transform .35s ease; }
    .nav-btn.active{ color:#a78bfa; }
    .nav-btn.active::after{ transform:translateX(-50%) scaleX(1); }
    .nav-btn:hover{ color:#c4b5fd; }
    .nav-btn:hover::after{ transform:translateX(-50%) scaleX(1); }
    @keyframes navFadeIn { 0%{opacity:0;transform:translateY(-8px)} 100%{opacity:1;transform:translateY(0)} }
    /* -------- Preloader -------- */
    #preloader {
      position: fixed; inset: 0; z-index: 100; display: grid; place-items: center;
      background: radial-gradient(1200px 800px at 70% 30%, rgba(88,28,135,.3), transparent 60%),
                  radial-gradient(1000px 700px at 20% 70%, rgba(37,99,235,.25), transparent 60%),
                  #0f172a;
      transition: opacity .5s ease, visibility .5s ease;
    }
    #preloader.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    .pre-wrap { position: relative; width: min(520px, 92vw); text-align: center; }
    .logo-badge {
      width: 84px; height: 84px; border-radius: 24px;
      background: linear-gradient(135deg, #7c3aed, #22d3ee);
      box-shadow: 0 10px 40px rgba(34,211,238,.25), inset 0 0 30px rgba(255,255,255,.06);
      display: grid; place-items: center; margin: 0 auto 14px;
    }
    .brand { font-weight: 800; letter-spacing: .5px; }
    .sub { color: rgba(255,255,255,.75); }
    .pre-bar { height: 10px; border-radius: 9999px; overflow: hidden; background: rgba(255,255,255,.08); margin-top: 18px; position: relative; }
    .pre-bar > .bar { height:100%; width:0%; background: linear-gradient(90deg, #8b5cf6, #3b82f6, #22d3ee); background-size:200% 100%; animation: preStripe 2.2s linear infinite; transition: width .25s ease; box-shadow:0 0 16px rgba(34,211,238,.35); }
    @keyframes preStripe { 0%{ background-position: 0% 0 } 100%{ background-position: 200% 0 } }
    .pre-bubbles { position: absolute; inset: -10vh 0 0 0; pointer-events: none; overflow: hidden; }
    .pre-bubbles .b { position: absolute; bottom: -6vh; width: var(--s); height: var(--s); border-radius: 9999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), rgba(124,58,237,.2) 55%, rgba(59,130,246,.15));
      filter: blur(0.2px); animation: bubbleUp var(--t) ease-in infinite; left: var(--x); }
    /* -------- Toast -------- */
    #toast { position: fixed; bottom: 1rem; right: 1rem; z-index: 60; display: flex; gap:.5rem; align-items:center;
      background: #10b981; color: #fff; padding: .75rem 1rem; border-radius: .75rem; box-shadow: 0 10px 26px rgba(0,0,0,.28);
      transform: translateY(140%); opacity: 0; transition: transform .35s, opacity .35s; }
    #toast.show { transform: translateY(0); opacity: 1; }
    /* -------- Components -------- */
    .drop-area { border: 2px dashed #8b5cf6; border-radius: 1rem; padding: 2rem; transition: .25s; }
    .drop-area.dragover { border-color: #60a5fa; background: rgba(96,165,250,.06); }
    .bar-sm { height: 10px; border-radius: 9999px; background: linear-gradient(90deg, #8b5cf6, #22d3ee); }
    .table-wrap{ overflow-x:auto; border:1px solid rgba(255,255,255,.10); border-radius:.75rem; }
    .table-wrap table{ width:100%; font-size:.9rem; } .table-wrap thead{ background:rgba(255,255,255,.09); text-align:left; }
    .table-wrap th,.table-wrap td{ padding:.6rem .8rem; white-space:nowrap; }
    /* -------- Analytics styles -------- */
    .analytics-grid { display:grid; gap:1rem; }
    @media (min-width: 640px){ .analytics-grid.sm-2{ grid-template-columns:repeat(2,minmax(0,1fr)) } }
    @media (min-width: 1024px){ .analytics-grid.lg-4{ grid-template-columns:repeat(4,minmax(0,1fr)) } }
    .card { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); border-radius: .75rem; padding: 1rem; }
    .kpi { display:grid; gap:.25rem; }
    .kpi .label{ color:rgba(255,255,255,.65); font-size:.85rem; }
    .kpi .value{ font-weight: 800; font-size: 1.6rem; }
    .kpi .delta{ font-size:.8rem; }
    .kpi .delta.up{ color:#34d399; } .kpi .delta.down{ color:#f87171; }
    .canvas-wrap{ position:relative; height:220px; } .canvas-wrap canvas{ width:100%; height:100%; }
    .legend{ display:flex; gap:.75rem; flex-wrap:wrap; font-size:.85rem; }
    .legend .dot{ width:10px; height:10px; border-radius:9999px; display:inline-block; margin-right:.4rem; }
    .tag{ display:inline-flex; align-items:center; gap:.4rem; padding:.25rem .5rem; border-radius:.5rem; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.10); font-size:.8rem; }
    .pill{ display:inline-block; padding:.35rem .6rem; border-radius:9999px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); font-size:.8rem; }
    .btn-ghost{ background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.10); padding:.5rem .75rem; border-radius:.5rem; transition:.25s; }
    .btn-ghost:hover{ background:rgba(255,255,255,.12); border-color:rgba(255,255,255,.18); }
    .btn-primary{ background:linear-gradient(90deg,#8b5cf6,#3b82f6,#22d3ee); color:#fff; padding:.55rem .85rem; border-radius:.55rem; transition:filter .25s; }
    .btn-primary:hover{ filter:brightness(1.05); }
    .spark{ width:100px; height:28px; }
    
    /* -------- Mobile improvements -------- */
    @media (max-width: 768px) {
      .nav-btn { padding: .5rem .75rem; font-size: .875rem; }
      .table-wrap { font-size: .75rem; }
      .table-wrap th, .table-wrap td { padding: .4rem .5rem; }
      .card { padding: .75rem; }
      .kpi .value { font-size: 1.25rem; }
      .canvas-wrap { height: 180px; }
      .pre-wrap { width: 90vw; }
      .logo-badge { width: 64px; height: 64px; }
      .brand { font-size: 1.5rem; }
      .sub { font-size: .875rem; }
    }
    
    /* -------- Loading states -------- */
    .loading { opacity: 0.6; pointer-events: none; }
    .loading::after { content: ''; position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; margin: -10px 0 0 -10px; border: 2px solid transparent; border-top: 2px solid #8b5cf6; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* -------- Error states -------- */
    .error { border-color: #ef4444 !important; background: rgba(239, 68, 68, 0.1) !important; }
    .error-message { color: #ef4444; font-size: .875rem; margin-top: .5rem; }
    
    /* -------- Success states -------- */
    .success { border-color: #10b981 !important; background: rgba(16, 185, 129, 0.1) !important; }
    
    /* -------- Smooth transitions -------- */
    * { transition: all 0.2s ease; }
    
    /* -------- Focus states -------- */
    input:focus, select:focus, textarea:focus { 
      outline: none; 
      border-color: #8b5cf6 !important; 
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1); 
    }
    
    /* -------- Button improvements -------- */
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    button:not(:disabled):hover { transform: translateY(-1px); }
    button:not(:disabled):active { transform: translateY(0); }
  </style>
</head>
<body class="font-inter bg-slate-900 text-white min-h-screen overflow-x-hidden">
  <!-- Preloader -->
  <div id="preloader" aria-hidden="true">
    <div class="pre-bubbles" id="bubbleField"></div>
    <div class="pre-wrap animate-fadeIn">
      <div class="logo-badge">
        <svg width="46" height="46" viewBox="0 0 48 48" fill="none" aria-label="DropFiles">
          <rect x="3" y="3" width="42" height="42" rx="12" stroke="white" stroke-opacity=".25"/>
          <path d="M14 16h11a7 7 0 0 1 0 14H14V16z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M25 23h-5v7" stroke="#22d3ee" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="brand text-3xl">DropFiles</div>
      <div class="sub mt-1">–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –Ω–∞ —Å–≤–æ—ë–º —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–µ</div>
      <div class="pre-bar"><div class="bar" id="preBar"></div></div>
      <div class="mt-3 text-xs text-white/60" id="preHint">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞‚Ä¶</div>
    </div>
  </div>
  
  <!-- Toast -->
  <div id="toast" role="status" aria-live="polite">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M9 12l2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    <span id="toast-text"></span>
  </div>
  
  <!-- NAV -->
  <nav class="fixed top-0 inset-x-0 z-40">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <button class="logo-anim text-xl sm:text-2xl font-bold tracking-tight hover:opacity-90 transition" onclick="show('home')">DropFiles</button>
      
      <!-- Mobile menu button -->
      <button id="mobile-menu-btn" class="md:hidden p-2 rounded-md bg-white/10 hover:bg-white/20 transition">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12h18M3 6h18M3 18h18"/>
        </svg>
      </button>
      
      <!-- Desktop navigation -->
      <div class="hidden md:flex items-center gap-2 sm:gap-4 text-sm">
        <button class="nav-btn" data-target="home">–ì–ª–∞–≤–Ω–∞—è</button>
        <button class="nav-btn" data-target="earn">–ó–∞—Ä–∞–±–æ—Ç–æ–∫</button>
        <button class="nav-btn" data-target="income">–î–æ—Ö–æ–¥</button>
        <button class="nav-btn auth-required" data-target="upload">–ó–∞–≥—Ä—É–∑–∫–∞</button>
        <button class="nav-btn auth-required" data-target="files">–§–∞–π–ª—ã</button>
        <button class="nav-btn" data-target="ref">–ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞</button>
        <button class="nav-btn auth-required" data-target="payouts">–í—ã–ø–ª–∞—Ç—ã</button>
        <button class="nav-btn" data-target="analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
        <button class="nav-btn" data-target="support">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
        <span class="w-px h-5 bg-white/15 hidden sm:inline-block"></span>
        <button id="nav-login" class="nav-btn px-3 py-1.5 rounded-md bg-white/10 hover:bg-white/20 transition" onclick="show('login')">–í–æ–π—Ç–∏</button>
        <button id="nav-register" class="nav-btn px-3 py-1.5 rounded-md bg-purple-600 hover:bg-purple-700 transition" onclick="show('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <div id="nav-user" class="hidden items-center gap-2">
          <span id="nav-username" class="text-white/80"></span>
          <button class="px-3 py-1.5 rounded-md bg-red-600/90 hover:bg-red-600 transition" onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
      </div>
    </div>
    
    <!-- Mobile navigation -->
    <div id="mobile-menu" class="md:hidden hidden bg-slate-800/95 backdrop-blur-md border-t border-white/10">
      <div class="px-4 py-3 space-y-2">
        <button class="nav-btn w-full text-left" data-target="home">–ì–ª–∞–≤–Ω–∞—è</button>
        <button class="nav-btn w-full text-left" data-target="earn">–ó–∞—Ä–∞–±–æ—Ç–æ–∫</button>
        <button class="nav-btn w-full text-left" data-target="income">–î–æ—Ö–æ–¥</button>
        <button class="nav-btn w-full text-left auth-required" data-target="upload">–ó–∞–≥—Ä—É–∑–∫–∞</button>
        <button class="nav-btn w-full text-left auth-required" data-target="files">–§–∞–π–ª—ã</button>
        <button class="nav-btn w-full text-left" data-target="ref">–ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞</button>
        <button class="nav-btn w-full text-left auth-required" data-target="payouts">–í—ã–ø–ª–∞—Ç—ã</button>
        <button class="nav-btn w-full text-left" data-target="analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
        <button class="nav-btn w-full text-left" data-target="support">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
        <div class="pt-2 border-t border-white/10">
          <button id="mobile-login" class="nav-btn w-full text-left px-3 py-2 rounded-md bg-white/10 hover:bg-white/20 transition" onclick="show('login')">–í–æ–π—Ç–∏</button>
          <button id="mobile-register" class="nav-btn w-full text-left px-3 py-2 rounded-md bg-purple-600 hover:bg-purple-700 transition" onclick="show('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
          <div id="mobile-user" class="hidden">
            <span id="mobile-username" class="block px-3 py-2 text-white/80"></span>
            <button class="nav-btn w-full text-left px-3 py-2 rounded-md bg-red-600/90 hover:bg-red-600 transition" onclick="logout()">–í—ã–π—Ç–∏</button>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <!-- MAIN -->
  <main class="max-w-6xl mx-auto px-4 pt-24 pb-24 space-y-16">
    <!-- –ì–ª–∞–≤–Ω–∞—è -->
    <section id="home" class="active animate-slideUp">
      <div class="reveal relative overflow-hidden rounded-2xl border border-white/10 bg-gradient-to-br from-white/5 to-white/0 p-6">
        <div class="absolute -top-12 -right-12 w-56 h-56 rounded-full bg-purple-600/20 blur-2xl animate-[fadeIn_2s_ease-in-out_infinite_alternate]"></div>
        <div class="absolute -bottom-16 -left-16 w-72 h-72 rounded-full bg-sky-500/20 blur-2xl animate-[fadeIn_2.5s_ease-in-out_infinite_alternate]"></div>
        <div class="grid md:grid-cols-2 gap-10 items-center relative">
          <div>
            <h1 class="text-4xl md:text-5xl font-extrabold leading-tight mb-4">–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –Ω–∞ —Å–≤–æ–∏—Ö —Ñ–∞–π–ª–∞—Ö –∏ —Å—Å—ã–ª–∫–∞—Ö</h1>
            <p class="text-white/70 mb-6">–ó–∞–≥—Ä—É–∂–∞–π –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π, –ø–æ–ª—É—á–∞–π –¥–æ—Ö–æ–¥ –∑–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã –∏ –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –±—ã—Å—Ç—Ä—ã–µ –≤—ã–ø–ª–∞—Ç—ã –∏ –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞.</p>
            <div class="flex flex-wrap gap-3">
              <button class="px-5 py-3 rounded-full bg-gradient-to-r from-purple-600 to-sky-500 hover:from-purple-700 hover:to-sky-600 transition" onclick="routeAuthOr('upload')">–ù–∞—á–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button>
              <button class="px-5 py-3 rounded-full bg-white/10 hover:bg-white/20 transition" onclick="show('earn')">–ö–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å</button>
            </div>
          </div>
          <div class="space-y-4">
            <div class="bg-white/5 rounded-xl p-4 border border-white/10">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-sm text-white/60">–§–∞–π–ª–æ–≤</div>
                  <div id="kpi-files" class="text-2xl font-bold">0</div>
                </div>
                <div class="w-28 bg-white/10 rounded-full overflow-hidden"><div class="bar-sm w-2/3"></div></div>
              </div>
            </div>
            <div class="grid grid-cols-3 gap-4">
              <div class="bg-white/5 rounded-xl p-4 border border-white/10 text-center">
                <div class="text-sm text-white/60">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
                <div id="kpi-views-home" class="text-xl font-bold">0</div>
              </div>
              <div class="bg-white/5 rounded-xl p-4 border border-white/10 text-center">
                <div class="text-sm text-white/60">–ó–∞–≥—Ä—É–∑–æ–∫</div>
                <div id="kpi-dls-home" class="text-xl font-bold">0</div>
              </div>
              <div class="bg-white/5 rounded-xl p-4 border border-white/10 text-center">
                <div class="text-sm text-white/60">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                <div id="kpi-earn-home" class="text-xl font-bold">0 ‚ÇΩ</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- –ó–∞—Ä–∞–±–æ—Ç–æ–∫ -->
    <section id="earn" class="animate-slideUp space-y-8">
      <h2 class="reveal text-3xl font-bold">–ó–∞—Ä–∞–±–æ—Ç–æ–∫</h2>
      <div class="grid md:grid-cols-3 gap-6">
        <div class="reveal bg-white/5 p-5 rounded-xl border border-white/10">
          <h3 class="font-semibold mb-2">–§–∞–π–ª—ã</h3>
          <p class="text-white/70 mb-3">–ó–∞–≥—Ä—É–∂–∞–π –ø–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã. –î–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π ‚Äî –ø–æ–ª—É—á–∞–π –¥–æ—Ö–æ–¥ –∑–∞ –∑–∞–≥—Ä—É–∑–∫–∏.</p>
          <button class="px-4 py-2 rounded-md bg-purple-600 hover:bg-purple-700" onclick="routeAuthOr('upload')">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
        <div class="reveal bg-white/5 p-5 rounded-xl border border-white/10">
          <h3 class="font-semibold mb-2">–ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏</h3>
          <p class="text-white/70 mb-3">–°–æ–∫—Ä–∞—â–∞–π —Å—Å—ã–ª–∫–∏ —Å UTM –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –Ω–∞ —Ç—Ä–∞—Ñ–∏–∫–µ.</p>
          <button class="px-4 py-2 rounded-md bg-white/10 hover:bg-white/20" onclick="routeAuthOr('files')">–ú–æ–∏ —Å—Å—ã–ª–∫–∏</button>
        </div>
        <div class="reveal bg-white/5 p-5 rounded-xl border border-white/10">
          <h3 class="font-semibold mb-2">–ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞</h3>
          <p class="text-white/70 mb-3">–ü—Ä–∏–≥–ª–∞—à–∞–π –∞–≤—Ç–æ—Ä–æ–≤ –∏ –ø–æ–ª—É—á–∞–π 10% –∏—Ö –¥–æ—Ö–æ–¥–∞.</p>
          <button class="px-4 py-2 rounded-md bg-white/10 hover:bg-white/20" onclick="show('ref')">–ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
        </div>
      </div>
    </section>
    <!-- –î–æ—Ö–æ–¥ -->
    <section id="income" class="animate-slideUp space-y-8">
      <h2 class="reveal text-3xl font-bold">–î–æ—Ö–æ–¥</h2>
      <div class="reveal grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-white/5 rounded-xl p-4 border border-white/10"><div class="text-white/60 text-sm">–í—Å–µ–≥–æ</div><div id="sum-total" class="text-3xl font-bold">0 ‚ÇΩ</div></div>
        <div class="bg-white/5 rounded-xl p-4 border border-white/10"><div class="text-white/60 text-sm">–°–µ–≥–æ–¥–Ω—è</div><div id="sum-today" class="text-3xl font-bold">0 ‚ÇΩ</div></div>
        <div class="bg-white/5 rounded-xl p-4 border border-white/10"><div class="text-white/60 text-sm">–ó–∞ 30 –¥–Ω–µ–π</div><div id="sum-month" class="text-3xl font-bold">0 ‚ÇΩ</div></div>
        <div class="bg-white/5 rounded-xl p-4 border border-white/10"><div class="text-white/60 text-sm">–û–∂–∏–¥–∞–µ—Ç –≤—ã–ø–ª–∞—Ç—ã</div><div id="sum-pending" class="text-3xl font-bold">0 ‚ÇΩ</div></div>
      </div>
      <div class="reveal bg-white/5 rounded-xl p-5 border border-white/10">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold">–î–∏–Ω–∞–º–∏–∫–∞ (7 –¥–Ω–µ–π)</h3>
          <div class="text-sm text-white/60">–°—É–º–º–∞ –ø–æ –¥–Ω—è–º</div>
        </div>
        <div id="chart" class="grid grid-cols-7 gap-3"></div>
      </div>
      <div class="reveal space-y-3">
        <h3 class="font-semibold text-xl">–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</h3>
        <div class="overflow-x-auto rounded-xl border border-white/10">
          <table class="w-full text-sm">
            <thead class="bg-white/10 text-left">
              <tr><th class="px-4 py-2">–î–∞—Ç–∞</th><th class="px-4 py-2">–ò—Å—Ç–æ—á–Ω–∏–∫</th><th class="px-4 py-2">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</th><th class="px-4 py-2">–î–æ—Ö–æ–¥</th></tr>
            </thead>
            <tbody id="history-body" class="divide-y divide-white/10"></tbody>
          </table>
        </div>
      </div>
    </section>
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    <section id="upload" class="animate-slideUp space-y-6">
      <h2 class="reveal text-3xl font-bold">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h2>
      <div class="reveal drop-area text-white/70" id="drop-area">
        <p class="mb-2">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏</p>
        <button class="px-4 py-2 rounded-md bg-sky-600 hover:bg-sky-700" onclick="triggerFile()">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
        <input type="file" id="fileElem" multiple class="hidden"/>
      </div>
      <div id="progress-wrapper" class="hidden space-y-2">
        <div class="w-full bg-white/10 h-3 rounded-full overflow-hidden"><div id="progress-bar" class="h-3 w-0 bg-gradient-to-r from-sky-500 to-emerald-400 transition-all"></div></div>
        <div class="text-sm text-white/70"><span id="progress-percent">0%</span></div>
      </div>
      <div class="reveal bg-white/5 rounded-xl p-5 border border-white/10">
        <h3 class="font-semibold mb-3">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ</h3>
        <div id="recent-files" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </div>
    </section>
    <!-- –§–∞–π–ª—ã -->
    <section id="files" class="animate-slideUp space-y-6">
      <h2 class="reveal text-3xl font-bold">–ú–æ–∏ —Ñ–∞–π–ª—ã</h2>
      <div class="reveal flex gap-3">
        <input id="search-files" class="px-3 py-2 rounded-md bg-white/10 w-full max-w-md outline-none" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."/>
        <button class="px-4 py-2 rounded-md bg-white/10 hover:bg-white/20" onclick="refreshFiles()">–°–±—Ä–æ—Å</button>
      </div>
      <div class="reveal table-wrap">
        <table>
          <thead><tr><th>–§–∞–π–ª</th><th>–†–∞–∑–º–µ—Ä</th><th>–ü—Ä–æ—Å–º.</th><th>–ó–∞–≥—Ä—É–∑–∫–∏</th><th>–î–æ—Ö–æ–¥</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
          <tbody id="files-body"></tbody>
        </table>
      </div>
    </section>
    <!-- –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞ -->
    <section id="ref" class="animate-slideUp space-y-6">
      <h2 class="reveal text-3xl font-bold">–ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h2>
      <p class="reveal text-white/70">–ü–æ–ª—É—á–∞–π—Ç–µ 10% –æ—Ç –¥–æ—Ö–æ–¥–∞ –∞–≤—Ç–æ—Ä–æ–≤, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –≤–∞—à–µ–π —Å—Å—ã–ª–∫–µ.</p>
      <div class="reveal bg-white/5 rounded-xl p-5 border border-white/10 space-y-4">
        <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
          <input id="ref-link" class="px-3 py-2 rounded-md bg-white/10 flex-1 outline-none" readonly/>
          <button class="px-4 py-2 rounded-md bg-purple-600 hover:bg-purple-700" onclick="copyRef()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
          <button class="px-4 py-2 rounded-md bg-white/10 hover:bg-white/20" onclick="routeAuthOr('register')">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
        </div>
        <div class="grid sm:grid-cols-4 gap-4">
          <div class="bg-white/5 rounded-lg p-4"><div class="text-white/60 text-sm">–ö–ª–∏–∫–∏</div><div id="ref-clicks" class="text-2xl font-bold">0</div></div>
          <div class="bg-white/5 rounded-lg p-4"><div class="text-white/60 text-sm">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div><div id="ref-signups" class="text-2xl font-bold">0</div></div>
          <div class="bg-white/5 rounded-lg p-4"><div class="text-white/60 text-sm">–ê–∫—Ç–∏–≤–Ω—ã–µ</div><div id="ref-active" class="text-2xl font-bold">0</div></div>
          <div class="bg-white/5 rounded-lg p-4"><div class="text-white/60 text-sm">–î–æ—Ö–æ–¥</div><div id="ref-earn" class="text-2xl font-bold">0 ‚ÇΩ</div></div>
        </div>
      </div>
    </section>
    <!-- –í—ã–ø–ª–∞—Ç—ã -->
    <section id="payouts" class="animate-slideUp space-y-6">
      <h2 class="reveal text-3xl font-bold">–í—ã–ø–ª–∞—Ç—ã</h2>
      <div class="grid lg:grid-cols-2 gap-6">
        <form id="form-payout" class="reveal bg-white/5 p-5 rounded-xl border border-white/10 space-y-3">
          <h3 class="font-semibold text-xl">–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–ø–ª–∞—Ç—É</h3>
          <div class="grid sm:grid-cols-2 gap-3">
            <div><label class="text-sm text-white/70">–°—É–º–º–∞ (‚ÇΩ)</label><input id="payout-amount" type="number" min="100" step="10" class="mt-1 px-3 py-2 rounded-md bg-white/10 w-full outline-none" required/></div>
            <div><label class="text-sm text-white/70">–ú–µ—Ç–æ–¥</label>
              <select id="payout-method" class="mt-1 px-3 py-2 rounded-md bg-white/10 w-full outline-none" required>
                <option value="–ö–∞—Ä—Ç–∞">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</option>
                <option value="USDT">USDT (TRC20)</option>
                <option value="–ÆMoney">–ÆMoney</option>
              </select>
            </div>
          </div>
          <div><label class="text-sm text-white/70">–†–µ–∫–≤–∏–∑–∏—Ç—ã</label><input id="payout-details" class="mt-1 px-3 py-2 rounded-md bg-white/10 w-full outline-none" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã / –∫–æ—à–µ–ª—ë–∫" required/></div>
          <button class="px-5 py-2.5 rounded-md bg-emerald-600 hover:bg-emerald-700">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
          <div class="text-xs text-white/60">–ú–∏–Ω. —Å—É–º–º–∞: 100 ‚ÇΩ. –°—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –¥–æ 24 —á–∞—Å–æ–≤.</div>
        </form>
        <div class="reveal bg-white/5 p-5 rounded-xl border border-white/10">
          <h3 class="font-semibold text-xl mb-3">–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–ª–∞—Ç</h3>
          <div class="overflow-x-auto rounded-lg border border-white/10">
            <table class="w-full text-sm">
              <thead class="bg-white/10 text-left"><tr><th class="px-4 py-2">–î–∞—Ç–∞</th><th class="px-4 py-2">–°—É–º–º–∞</th><th class="px-4 py-2">–ú–µ—Ç–æ–¥</th><th class="px-4 py-2">–°—Ç–∞—Ç—É—Å</th></tr></thead>
              <tbody id="payouts-body" class="divide-y divide-white/10"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
    <!-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ -->
    <section id="support" class="animate-slideUp space-y-6">
      <h2 class="reveal text-3xl font-bold">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ FAQ</h2>
      <div class="reveal space-y-3">
        <div class="bg-white/5 rounded-xl border border-white/10">
          <button class="w-full text-left p-4 flex justify-between items-center" onclick="toggleAccordion(this.nextElementSibling)">
            <span><b>–í—ã–ø–ª–∞—Ç—ã:</b> —Å—Ä–æ–∫–∏ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞</span><span>‚ñæ</span>
          </button>
          <div class="accordion-content px-4 pb-4 text-white/80" style="display: none;">–ú–∏–Ω. —Å—É–º–º–∞ ‚Äî 100 ‚ÇΩ. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ 24 —á–∞—Å–æ–≤.</div>
        </div>
        <div class="bg-white/5 rounded-xl border border-white/10">
          <button class="w-full text-left p-4 flex justify-between items-center" onclick="toggleAccordion(this.nextElementSibling)">
            <span><b>–ö–æ–Ω—Ç–µ–Ω—Ç:</b> —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –º–æ–¥–µ—Ä–∞—Ü–∏—è</span><span>‚ñæ</span>
          </button>
          <div class="accordion-content px-4 pb-4 text-white/80" style="display: none;">–†–∞–∑–º–µ—â–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø—Ä–∞–≤–∞ –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —É –≤–∞—Å –µ—Å—Ç—å. –ó–∞–ø—Ä–µ—â—ë–Ω –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∏ –Ω–µ–ª–µ–≥–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç.</div>
        </div>
      </div>
      <form id="form-support" class="reveal bg-white/5 p-5 rounded-xl border border-white/10 space-y-3">
        <h3 class="font-semibold text-xl">–°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ</h3>
        <div class="grid sm:grid-cols-2 gap-3">
          <input id="sup-email" type="email" class="px-3 py-2 rounded-md bg-white/10 outline-none" placeholder="–í–∞—à email" required/>
          <select id="sup-topic" class="px-3 py-2 rounded-md bg-white/10 outline-none" required>
            <option>–í—ã–ø–ª–∞—Ç—ã</option><option>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å</option><option>–ñ–∞–ª–æ–±–∞</option><option>–î—Ä—É–≥–æ–µ</option>
          </select>
        </div>
        <textarea id="sup-text" rows="4" class="px-3 py-2 rounded-md bg-white/10 w-full outline-none" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É..." required></textarea>
        <button class="px-5 py-2.5 rounded-md bg-white/10 hover:bg-white/20">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>
    </section>
    <!-- –í—Ö–æ–¥ -->
    <section id="login" class="animate-slideUp space-y-6">
      <h2 class="reveal text-3xl font-bold text-center">–í—Ö–æ–¥</h2>
      <form id="form-login" class="reveal max-w-md mx-auto space-y-4">
        <input id="login-user" class="w-full p-3 bg-white/10 rounded-lg outline-none" placeholder="–õ–æ–≥–∏–Ω" required/>
        <input id="login-pass" type="password" class="w-full p-3 bg-white/10 rounded-lg outline-none" placeholder="–ü–∞—Ä–æ–ª—å" required/>
        <button class="w-full py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">–í–æ–π—Ç–∏</button>
      </form>
      <p class="reveal text-center text-white/70">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <button class="text-purple-400 hover:underline" onclick="show('register')">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button></p>
    </section>
    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
    <section id="register" class="animate-slideUp space-y-6">
      <h2 class="reveal text-3xl font-bold text-center">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <form id="form-register" class="reveal max-w-md mx-auto space-y-4">
        <input id="reg-user" class="w-full p-3 bg-white/10 rounded-lg outline-none" placeholder="–õ–æ–≥–∏–Ω" required/>
        <input id="reg-email" type="email" class="w-full p-3 bg-white/10 rounded-lg outline-none" placeholder="Email" required/>
        <input id="reg-pass" type="password" class="w-full p-3 bg-white/10 rounded-lg outline-none" placeholder="–ü–∞—Ä–æ–ª—å" required/>
        <input id="reg-confirm" type="password" class="w-full p-3 bg-white/10 rounded-lg outline-none" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required/>
        <button class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 rounded-lg font-semibold">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      </form>
      <p class="reveal text-center text-white/70">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <button class="text-purple-400 hover:underline" onclick="show('login')">–í–æ–π—Ç–∏</button></p>
    </section>
    <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
    <section id="analytics" class="animate-slideUp space-y-8">
      <h2 class="reveal text-3xl font-bold">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
      <div class="reveal card">
        <div class="flex flex-col md:flex-row gap-3 md:items-end md:justify-between">
          <div class="flex flex-wrap gap-2">
            <button class="btn-ghost" data-range="today">–°–µ–≥–æ–¥–Ω—è</button>
            <button class="btn-ghost" data-range="7d">7 –¥–Ω–µ–π</button>
            <button class="btn-ghost" data-range="30d">30 –¥–Ω–µ–π</button>
            <button class="btn-ghost" data-range="90d">90 –¥–Ω–µ–π</button>
          </div>
          <div class="flex flex-wrap gap-2">
            <select id="an-source" class="pill">
              <option value="all">–í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</option>
              <option value="files">–§–∞–π–ª—ã</option>
              <option value="links">–°—Å—ã–ª–∫–∏</option>
              <option value="ref">–ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞</option>
            </select>
            <select id="an-device" class="pill">
              <option value="all">–í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</option>
              <option value="desktop">Desktop</option>
              <option value="mobile">Mobile</option>
              <option value="tablet">Tablet</option>
              <option value="bot">Bot</option>
            </select>
            <select id="an-country" class="pill"><option value="all">–í—Å–µ —Å—Ç—Ä–∞–Ω—ã</option></select>
            <button id="an-export" class="btn-ghost">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
            <button id="an-sim" class="btn-primary">–°–∏–º—É–ª—è—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞</button>
          </div>
        </div>
      </div>
      <div class="reveal analytics-grid lg-4">
        <div class="card kpi">
          <div class="label">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</div>
          <div id="an-kpi-views" class="value">0</div>
          <div id="an-kpi-views-delta" class="delta"></div>
        </div>
        <div class="card kpi">
          <div class="label">–ó–∞–≥—Ä—É–∑–∫–∏</div>
          <div id="an-kpi-dls" class="value">0</div>
          <div id="an-kpi-dls-delta" class="delta"></div>
        </div>
        <div class="card kpi">
          <div class="label">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div>
          <div id="an-kpi-cr" class="value">0%</div>
          <div id="an-kpi-cr-delta" class="delta"></div>
        </div>
        <div class="card kpi">
          <div class="label">–î–æ—Ö–æ–¥ / eCPM</div>
          <div id="an-kpi-earn" class="value">0 ‚ÇΩ</div>
          <div id="an-kpi-ecpm" class="delta"></div>
        </div>
      </div>
      <div class="reveal analytics-grid sm-2">
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">–î–∏–Ω–∞–º–∏–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞</div>
            <div class="legend">
              <span><span class="dot" style="background:#60a5fa"></span>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</span>
              <span><span class="dot" style="background:#34d399"></span>–ó–∞–≥—Ä—É–∑–∫–∏</span>
            </div>
          </div>
          <div class="canvas-wrap"><canvas id="chart-traffic"></canvas></div>
        </div>
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</div>
            <div class="legend" id="legend-dev"></div>
          </div>
          <div class="canvas-wrap"><canvas id="chart-devices"></canvas></div>
        </div>
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">–ò—Å—Ç–æ—á–Ω–∏–∫–∏</div>
          </div>
          <div class="canvas-wrap"><canvas id="chart-sources"></canvas></div>
        </div>
        <div class="card">
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">–°—Ç—Ä–∞–Ω—ã</div>
          </div>
          <div class="canvas-wrap"><canvas id="chart-countries"></canvas></div>
        </div>
      </div>
      <div class="reveal analytics-grid sm-2">
        <div class="card">
          <div class="flex items-center justify-between mb-3">
            <div class="font-semibold">–¢–æ–ø —Ñ–∞–π–ª–æ–≤</div>
            <div class="text-sm text-white/60">–ü–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º</div>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>–§–∞–π–ª</th><th>–ü—Ä–æ—Å–º.</th><th>–ó–∞–≥—Ä—É–∑.</th><th>CTR</th><th>–î–æ—Ö–æ–¥</th><th>–¢—Ä–µ–Ω–¥</th></tr></thead>
              <tbody id="an-top-files"></tbody>
            </table>
          </div>
        </div>
        <div class="card">
          <div class="flex items-center justify-between mb-3">
            <div class="font-semibold">–¢–æ–ø —Ä–µ—Ñ–µ—Ä–µ—Ä—ã</div>
            <div class="text-sm text-white/60">–ü–æ –≤–∏–∑–∏—Ç–∞–º</div>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>–ò—Å—Ç–æ—á–Ω–∏–∫</th><th>–í–∏–∑–∏—Ç—ã</th><th>–ó–∞–≥—Ä—É–∑–∫–∏</th><th>–ö–æ–Ω–≤–µ—Ä—Å–∏—è</th></tr></thead>
              <tbody id="an-top-ref"></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="reveal card">
        <div class="flex items-center justify-between mb-3">
          <div class="font-semibold">–°–æ–±—ã—Ç–∏—è</div>
          <div class="text-sm text-white/60" id="an-events-count">0 —Å–æ–±—ã—Ç–∏–π</div>
        </div>
        <div id="an-events" class="space-y-2 max-h-80 overflow-auto"></div>
      </div>
    </section>
  </main>
  <footer class="border-t border-white/10 py-8 text-center text-white/60">
    ¬© 2025 DropFiles. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
  </footer>
  <script>
    // ---------- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ localStorage (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥—ã) ----------
    const appData = {
      user: null,
      pass: null,
      email: null,
      files: [],
      hist: [],
      payouts: [],
      ref: { code: null, clicks: 0, signups: 0, active: 0, earn: 0 },
      tickets: [],
      events: []
    };
    
    // ---------- Utils ----------
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);
    const LS = { user:'drop_user', pass:'drop_pass', email:'drop_email', files:'drop_files', hist:'drop_history', payouts:'drop_payouts', ref:'drop_ref', tickets:'drop_tickets', events:'drop_events' };
    const fmt = n => n.toLocaleString('ru-RU');
    
    function toast(msg, ok=true){
      const el = $('#toast');
      if (!el) return;
      
      el.style.background = ok ? '#10b981' : '#ef4444';
      $('#toast-text').textContent = msg;
      el.classList.add('show');
      
      setTimeout(() => {
        if (el) el.classList.remove('show');
      }, 2600);
    }
    
    function copy(t){
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(t).then(() => {
          toast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ');
        }).catch(() => {
          fallbackCopy(t);
        });
      } else {
        fallbackCopy(t);
      }
    }
    
    function fallbackCopy(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      textArea.style.top = '-999999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        document.execCommand('copy');
        toast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ');
      } catch (err) {
        toast('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', false);
      }
      
      document.body.removeChild(textArea);
    }
    
    function formatSize(b){
      if(b < 1024) return b + ' B';
      if(b < 1024 * 1024) return (b / 1024).toFixed(1) + ' KB';
      if(b < 1024 * 1024 * 1024) return (b / (1024 * 1024)).toFixed(1) + ' MB';
      return (b / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
    }
    
    function today(){
      const d = new Date();
      return `${d.getDate().toString().padStart(2, '0')}.${(d.getMonth()+1).toString().padStart(2, '0')}.${d.getFullYear()}`;
    }
    
    function isAuth(){
      return !!appData.user;
    }
    
    function requireAuth(){
      try {
        if(!isAuth()){
          toast('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å', false);
          show('login');
          return false;
        }
        return true;
      } catch (error) {
        console.error('Error checking auth:', error);
        toast('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', false);
        return false;
      }
    }
    
    function routeAuthOr(id){
      try {
        if(isAuth()) {
          show(id);
        } else {
          show('login');
        }
      } catch (error) {
        console.error('Error routing:', error);
        show('login');
      }
    }
    
    function uuid(){
      try {
        if (crypto && crypto.getRandomValues) {
          return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
            (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
          );
        } else {
          // Fallback for older browsers
          return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            const r = Math.random() * 16 | 0;
            const v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
          });
        }
      } catch (error) {
        console.error('Error generating UUID:', error);
        return 'fallback-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
      }
    }
    
    // ---------- Preloader ----------
    function spawnBubbles(){
      try {
        const field = document.getElementById('bubbleField');
        if(!field) return;
        
        const N = 18;
        for(let i = 0; i < N; i++){
          const b = document.createElement('span');
          b.className = 'b';
          b.style.setProperty('--s', Math.floor(Math.random() * 28 + 16) + 'px');
          b.style.setProperty('--x', Math.floor(Math.random() * 96) + '%');
          b.style.setProperty('--t', (Math.random() * 3 + 4).toFixed(2) + 's');
          b.style.animationDelay = (Math.random() * 2).toFixed(2) + 's';
          field.appendChild(b);
        }
      } catch (error) {
        console.error('Error spawning bubbles:', error);
      }
    }
    
    function setPreProgress(p){
      try {
        const preBar = document.getElementById('preBar');
        if (!preBar) return;
        
        preBar.style.width = Math.min(100, Math.max(0, p)) + '%';
      } catch (error) {
        console.error('Error setting preloader progress:', error);
      }
    }
    
    function finishPreloader(){
      try {
        const pre = document.getElementById('preloader');
        const preBar = document.getElementById('preBar');
        const preHint = document.getElementById('preHint');
        
        if (!preBar || !preHint) return;
        
        setPreProgress(100);
        preHint.textContent = '–ì–æ—Ç–æ–≤–æ!';
        
        setTimeout(() => {
          try {
            if (pre) pre.classList.add('hidden');
          } catch (error) {
            console.error('Error hiding preloader:', error);
          }
        }, 250);
      } catch (error) {
        console.error('Error finishing preloader:', error);
      }
    }
    
    document.addEventListener('DOMContentLoaded', ()=>{
      try {
        spawnBubbles();
        let p = 0;
        const tick = setInterval(() => {
          try {
            p += Math.random() * 9 + 4;
            if(p >= 90){
              p = 90;
              clearInterval(tick);
            }
            setPreProgress(p);
          } catch (error) {
            console.error('Error in preloader tick:', error);
            clearInterval(tick);
          }
        }, 180);
        
        setTimeout(finishPreloader, 4500);
      } catch (error) {
        console.error('Error in DOMContentLoaded preloader:', error);
      }
    });
    
    window.addEventListener('load', () => {
      try {
        setTimeout(finishPreloader, 300);
      } catch (error) {
        console.error('Error in load event:', error);
      }
    });
    
    // ---------- Nav: hide/show on scroll ----------
    let lastScroll = 0, glowTimeout;
    const navEl = document.querySelector('nav');
    
    if (navEl) {
      window.addEventListener('scroll', () => {
        try {
          const curr = window.scrollY;
          if (curr > lastScroll && curr > 80) {
            navEl.classList.add('nav-hidden');
          } else {
            navEl.classList.remove('nav-hidden');
            navEl.classList.add('nav-show-glow');
            clearTimeout(glowTimeout);
            glowTimeout = setTimeout(() => {
              try {
                navEl.classList.remove('nav-show-glow');
              } catch (error) {
                console.error('Error removing nav glow:', error);
              }
            }, 500);
          }
          lastScroll = curr;
        } catch (error) {
          console.error('Error in scroll handler:', error);
        }
      });
    }
    
    // ---------- Mobile menu ----------
    function toggleMobileMenu() {
      try {
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        
        if (mobileMenu && mobileMenuBtn) {
          const isHidden = mobileMenu.classList.contains('hidden');
          
          if (isHidden) {
            mobileMenu.classList.remove('hidden');
            mobileMenuBtn.innerHTML = `
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 18L18 6M6 6l12 12"/>
              </svg>
            `;
          } else {
            mobileMenu.classList.add('hidden');
            mobileMenuBtn.innerHTML = `
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12h18M3 6h18M3 18h18"/>
              </svg>
            `;
          }
        }
      } catch (error) {
        console.error('Error toggling mobile menu:', error);
      }
    }
    
    // ---------- Navigation SPA switch ----------
    function highlightNav(id){
      try {
        document.querySelectorAll('nav .nav-btn').forEach(b => {
          b.classList.toggle('active', b.dataset.target === id);
        });
        
        // Close mobile menu when navigating
        const mobileMenu = document.getElementById('mobile-menu');
        if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
          toggleMobileMenu();
        }
      } catch (error) {
        console.error('Error highlighting nav:', error);
      }
    }
    
    function show(id){
      try {
        const current = document.querySelector('main section.active');
        const next = document.getElementById(id);
        
        if(!next) {
          console.warn('Section not found:', id);
          return;
        }
        
        const guard = ['upload', 'files', 'payouts', 'ref', 'analytics'];
        if(guard.includes(id) && !isAuth()){
          toast('–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —Ä–∞–∑–¥–µ–ª', false);
          show('login');
          return;
        }
        
        if(current && current !== next){
          current.classList.remove('active');
          current.classList.add('section-fade');
        }
        
        setTimeout(() => {
          try {
            document.querySelectorAll('main section').forEach(s => {
              s.classList.remove('active');
              s.classList.add('section-fade');
            });
            
            const sec = document.getElementById(id);
            if(!sec) return;
            
            sec.classList.remove('section-fade');
            sec.classList.add('active');
            
            highlightNav(id);
            
            if(id === 'home') renderKPIs();
            if(id === 'income') { renderSums(); renderChart(); renderHistory(); }
            if(id === 'upload') renderRecentFiles();
            if(id === 'files') renderFiles();
            if(id === 'payouts') renderPayouts();
            if(id === 'ref') renderRef();
            if(id === 'analytics') renderAnalytics();
            
            // reveal visible for first fold
            sec.querySelectorAll('.reveal').forEach(el => {
              el.classList.add('visible');
            });
          } catch (error) {
            console.error('Error in show timeout:', error);
          }
        }, current ? 280 : 0);
      } catch (error) {
        console.error('Error showing section:', error);
        toast('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞', false);
      }
    }
    
    document.querySelectorAll('nav .nav-btn').forEach((btn, i) => {
      btn.addEventListener('click', () => {
        try {
          show(btn.dataset.target);
        } catch (error) {
          console.error('Error in nav button click:', error);
        }
      });
      btn.style.animationDelay = `${0.1 * i + 0.3}s`;
    });
    
    // ---------- Reveal on scroll ----------
    const revealObserver = new IntersectionObserver((entries, obs) => {
      try {
        entries.forEach(e => {
          if(e.isIntersecting){
            e.target.classList.add('visible');
            obs.unobserve(e.target);
          }
        });
      } catch (error) {
        console.error('Error in reveal observer:', error);
      }
    }, { threshold: .1 });
    
    document.addEventListener('DOMContentLoaded', () => {
      try {
        document.querySelectorAll('.reveal').forEach(el => {
          try {
            revealObserver.observe(el);
          } catch (error) {
            console.error('Error observing reveal element:', error);
          }
        });
        
        // section fade initial
        document.querySelectorAll('main section').forEach(s => {
          try {
            if(!s.classList.contains('active')) {
              s.classList.add('section-fade');
            }
          } catch (error) {
            console.error('Error setting section fade:', error);
          }
        });
      } catch (error) {
        console.error('Error in DOMContentLoaded reveal setup:', error);
      }
    });
    
    // ---------- Auth UI ----------
    function initAuthUI(){
      const logged = isAuth();
      
      // Desktop navigation
      const navLogin = document.getElementById('nav-login');
      const navRegister = document.getElementById('nav-register');
      const navUser = document.getElementById('nav-user');
      
      if (navLogin) navLogin.classList.toggle('hidden', logged);
      if (navRegister) navRegister.classList.toggle('hidden', logged);
      if (navUser) navUser.classList.toggle('hidden', !logged);
      
      if(logged && document.getElementById('nav-username')) {
        document.getElementById('nav-username').textContent = appData.user;
      }
      
      // Mobile navigation
      const mobileLogin = document.getElementById('mobile-login');
      const mobileRegister = document.getElementById('mobile-register');
      const mobileUser = document.getElementById('mobile-user');
      const mobileUsername = document.getElementById('mobile-username');
      
      if (mobileLogin) mobileLogin.classList.toggle('hidden', logged);
      if (mobileRegister) mobileRegister.classList.toggle('hidden', logged);
      if (mobileUser) mobileUser.classList.toggle('hidden', !logged);
      
      if(logged && mobileUsername) {
        mobileUsername.textContent = appData.user;
      }
      
      document.querySelectorAll('.auth-required').forEach(b => {
        b.disabled = !logged;
      });
    }
    
    function logout(){
      try {
        const keepRef = appData.ref;
        appData.user = null;
        appData.pass = null;
        appData.email = null;
        appData.ref = keepRef;
        initAuthUI();
        show('home');
        toast('–í—ã –≤—ã—à–ª–∏', false);
      } catch (error) {
        console.error('Error during logout:', error);
        toast('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞', false);
      }
    }
    
    const formRegister = document.getElementById('form-register');
    if (formRegister) {
      formRegister.addEventListener('submit', e => {
        e.preventDefault();
        
        const userInput = document.getElementById('reg-user');
        const emailInput = document.getElementById('reg-email');
        const passInput = document.getElementById('reg-pass');
        const confirmInput = document.getElementById('reg-confirm');
        
        // Validate all inputs
        const isUserValid = validateInput(userInput, 'text');
        const isEmailValid = validateInput(emailInput, 'email');
        const isPassValid = validateInput(passInput, 'password');
        const isConfirmValid = validateInput(confirmInput, 'text');
        
        if (!isUserValid || !isEmailValid || !isPassValid || !isConfirmValid) {
          return;
        }
        
        const u = userInput.value.trim();
        const email = emailInput.value.trim();
        const p = passInput.value;
        const c = confirmInput.value;
        
        if(p !== c) {
          confirmInput.classList.add('error');
          const errorEl = document.createElement('div');
          errorEl.className = 'error-message';
          errorEl.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
          confirmInput.parentNode.appendChild(errorEl);
          return;
        }
        
        try {
          appData.user = u;
          appData.email = email;
          appData.pass = p;
          
          seedIfEmpty();
          initAuthUI();
          toast('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞');
          show('upload');
          
          // Clear form
          formRegister.reset();
        } catch (error) {
          console.error('Registration error:', error);
          toast('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', false);
        }
      });
    }
    
    const formLogin = document.getElementById('form-login');
    if (formLogin) {
      formLogin.addEventListener('submit', e => {
        e.preventDefault();
        
        const userInput = document.getElementById('login-user');
        const passInput = document.getElementById('login-pass');
        
        // Validate inputs
        const isUserValid = validateInput(userInput, 'text');
        const isPassValid = validateInput(passInput, 'password');
        
        if (!isUserValid || !isPassValid) {
          return;
        }
        
        const u = userInput.value.trim();
        const p = passInput.value;
        
        try {
          if(u === appData.user && p === appData.pass) {
            seedIfEmpty();
            initAuthUI();
            toast('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
            show('income');
            
            // Clear form
            formLogin.reset();
          } else {
            toast('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', false);
            userInput.classList.add('error');
            passInput.classList.add('error');
          }
        } catch (error) {
          console.error('Login error:', error);
          toast('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞', false);
        }
      });
    }
    
    // ---------- Seed data ----------
    function seedIfEmpty(){
      try {
        if(appData.files.length === 0){
          appData.files = [
            mkFile('–ü—Ä–∏–º–µ—Ä–≥–∞–π–¥.pdf', 1240000, 3200, 740, 412.50),
            mkFile('–®–∞–±–ª–æ–Ω–ø–æ—Å—Ç–µ—Ä–∞.psd', 54000000, 2100, 190, 265.00),
            mkFile('–ê—Ä—Ö–∏–≤—Ä–µ—Å—É—Ä—Å–æ–≤.zip', 120000000, 980, 75, 120.00)
          ];
        }
        
        if(appData.hist.length === 0){
          const days = 7;
          const arr = [];
          for(let i = days - 1; i >= 0; i--){
            const d = new Date();
            d.setDate(d.getDate() - i);
            const dateStr = `${d.getDate().toString().padStart(2, '0')}.${(d.getMonth()+1).toString().padStart(2, '0')}.${d.getFullYear()}`;
            
            arr.push({
              date: dateStr,
              source: ['–§–∞–π–ª—ã', '–ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞', '–°—Å—ã–ª–∫–∏'][Math.floor(Math.random() * 3)],
              views: Math.floor(Math.random() * 1500 + 300),
              income: +(Math.random() * 120 + 20).toFixed(2)
            });
          }
          appData.hist = arr;
        }
        
        if(appData.payouts.length === 0){
          const d = new Date(Date.now() - 86400000 * 12);
          const dateStr = `${d.getDate().toString().padStart(2, '0')}.${(d.getMonth()+1).toString().padStart(2, '0')}.${d.getFullYear()}`;
          
          appData.payouts = [{
            date: dateStr,
            amount: 1200,
            method: '–ö–∞—Ä—Ç–∞',
            status: '–í—ã–ø–ª–∞—á–µ–Ω–æ'
          }];
        }
        
        if(!appData.ref.code){
          appData.ref = {
            code: genRefCode(),
            clicks: 43,
            signups: 7,
            active: 5,
            earn: 318.50
          };
        }
        
        if(appData.tickets.length === 0){
          appData.tickets = [];
        }
        
        if(appData.events.length === 0){
          seedEventsIfEmpty();
        }
      } catch (error) {
        console.error('Error seeding data:', error);
        toast('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö', false);
      }
    }
    
    function mkFile(name, size, views = 0, dls = 0, earn = 0){
      try {
        return {
          id: uuid(),
          name: name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
          size: size || 0,
          uploadedAt: new Date().toISOString(),
          views: views || 0,
          downloads: dls || 0,
          earnings: +(earn || 0),
          link: genFileLink(name || '')
        };
      } catch (error) {
        console.error('Error creating file object:', error);
        return {
          id: 'error-' + Date.now(),
          name: '–û—à–∏–±–∫–∞',
          size: 0,
          uploadedAt: new Date().toISOString(),
          views: 0,
          downloads: 0,
          earnings: 0,
          link: '#'
        };
      }
    }
    
    function genFileLink(name){
      try {
        const base = 'https://dropfiles.example/u/';
        const u = appData.user || 'guest';
        return base + encodeURIComponent(u) + '/' + encodeURIComponent(name || '');
      } catch (error) {
        console.error('Error generating file link:', error);
        return '#';
      }
    }
    
    function genRefCode(){
      try {
        const u = appData.user || 'guest';
        return (u + '-' + Math.random().toString(36).slice(2, 8)).toUpperCase();
      } catch (error) {
        console.error('Error generating ref code:', error);
        return 'REF-' + Date.now().toString(36).slice(-6).toUpperCase();
      }
    }
    
    // ---------- Home KPIs ----------
    function renderKPIs(){
      try {
        const files = appData.files;
        const kpiFiles = document.getElementById('kpi-files');
        const kpiViewsHome = document.getElementById('kpi-views-home');
        const kpiDlsHome = document.getElementById('kpi-dls-home');
        const kpiEarnHome = document.getElementById('kpi-earn-home');
        
        if (kpiFiles) kpiFiles.textContent = files.length;
        if (kpiViewsHome) kpiViewsHome.textContent = fmt(files.reduce((s, f) => s + (f.views || 0), 0));
        if (kpiDlsHome) kpiDlsHome.textContent = fmt(files.reduce((s, f) => s + (f.downloads || 0), 0));
        
        const totalEarn = files.reduce((s, f) => s + (f.earnings || 0), 0) + (appData.ref.earn || 0);
        
        if (kpiEarnHome) kpiEarnHome.textContent = totalEarn.toFixed(2) + ' ‚ÇΩ';
      } catch (error) {
        console.error('Error rendering KPIs:', error);
      }
    }
    
    // ---------- Income ----------
    function renderSums(){
      try {
        const hist = appData.hist;
        const filesEarn = appData.files.reduce((s, f) => s + (f.earnings || 0), 0);
        const refEarn = appData.ref.earn || 0;
        
        const grand = filesEarn + refEarn;
        const todaySum = hist.filter(r => r.date === today()).reduce((s, r) => s + (r.income || 0), 0);
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ –∑–∞ –¥–µ–Ω—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
        const last7Days = hist.slice(-7);
        const avgDailyIncome = last7Days.reduce((s, r) => s + (r.income || 0), 0) / Math.max(last7Days.length, 1);
        const month = avgDailyIncome * 30;
        
        const paid = appData.payouts.filter(p => p.status === '–í—ã–ø–ª–∞—á–µ–Ω–æ').reduce((s, p) => s + (p.amount || 0), 0);
        const pending = Math.max(0, grand - paid);
        
        const sumTotal = document.getElementById('sum-total');
        const sumToday = document.getElementById('sum-today');
        const sumMonth = document.getElementById('sum-month');
        const sumPending = document.getElementById('sum-pending');
        
        if (sumTotal) sumTotal.textContent = grand.toFixed(2) + ' ‚ÇΩ';
        if (sumToday) sumToday.textContent = todaySum.toFixed(2) + ' ‚ÇΩ';
        if (sumMonth) sumMonth.textContent = Math.max(month, grand).toFixed(2) + ' ‚ÇΩ';
        if (sumPending) sumPending.textContent = pending.toFixed(2) + ' ‚ÇΩ';
      } catch (error) {
        console.error('Error rendering sums:', error);
      }
    }
    
    function renderChart(){
      try {
        const chart = document.getElementById('chart');
        if (!chart) return;
        
        chart.innerHTML = '';
        const last7 = appData.hist.slice(-7);
        
        if (last7.length === 0) return;
        
        const max = Math.max(1, ...last7.map(r => r.income || 0));
        
        last7.forEach(r => {
          const wrap = document.createElement('div');
          wrap.className = 'flex flex-col gap-1 items-stretch';
          
          const val = document.createElement('div');
          val.className = 'text-xs text-white/80';
          val.textContent = (r.income || 0).toFixed(0) + ' ‚ÇΩ';
          
          const bar = document.createElement('div');
          bar.className = 'bar-sm';
          bar.style.width = ((r.income || 0) / max * 100).toFixed(0) + '%';
          
          const lab = document.createElement('div');
          lab.className = 'text-xs text-white/60';
          lab.textContent = (r.date || '').split('.').slice(0, 2).join('.');
          
          wrap.append(val, bar, lab);
          chart.appendChild(wrap);
        });
      } catch (error) {
        console.error('Error rendering chart:', error);
      }
    }
    
    function renderHistory(){
      try {
        const body = document.getElementById('history-body');
        if (!body) return;
        
        body.innerHTML = '';
        
        appData.hist.slice().reverse().forEach(r => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td class="px-4 py-2">${r.date || ''}</td>
                          <td class="px-4 py-2">${r.source || ''}</td>
                          <td class="px-4 py-2">${r.views || 0}</td>
                          <td class="px-4 py-2">${(r.income || 0).toFixed(2)} ‚ÇΩ</td>`;
          body.appendChild(tr);
        });
      } catch (error) {
        console.error('Error rendering history:', error);
      }
    }
    
    // ---------- Upload ----------
    const dropArea = document.getElementById('drop-area');
    const fileElem = document.getElementById('fileElem');
    const progWrap = document.getElementById('progress-wrapper');
    const progBar = document.getElementById('progress-bar');
    const progPct = document.getElementById('progress-percent');
    
    if(dropArea){
      ['dragover', 'dragenter'].forEach(ev => {
        dropArea.addEventListener(ev, e => {
          try {
            e.preventDefault();
            dropArea.classList.add('dragover');
          } catch (error) {
            console.error('Error in drag event:', error);
          }
        });
      });
      
      ['dragleave', 'drop'].forEach(ev => {
        dropArea.addEventListener(ev, e => {
          try {
            if(ev === 'drop'){
              e.preventDefault();
              handleDrop(e);
            }
            dropArea.classList.remove('dragover');
          } catch (error) {
            console.error('Error in drop event:', error);
          }
        });
      });
    }
    
    function triggerFile(){
      if(requireAuth()) {
        if (fileElem) fileElem.click();
      }
    }
    
    if(fileElem) {
      fileElem.addEventListener('change', (e) => {
        try {
          startUpload();
        } catch (error) {
          console.error('Error in file change event:', error);
          toast('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤', false);
        }
      });
    }
    
    function handleDrop(e){
      try {
        if(!requireAuth()) return;
        if (fileElem) {
          fileElem.files = e.dataTransfer.files;
          startUpload();
        }
      } catch (error) {
        console.error('Error handling drop:', error);
        toast('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è', false);
      }
    }
    
    function startUpload(){
      if (!fileElem || !fileElem.files || fileElem.files.length === 0) return;
      
      const files = fileElem.files;
      
      // Validate file types and sizes
      const maxSize = 100 * 1024 * 1024; // 100MB
      const allowedTypes = ['image/', 'video/', 'audio/', 'text/', 'application/'];
      
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        
        if (file.size > maxSize) {
          toast(`–§–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 100MB)`, false);
          return;
        }
        
        const isValidType = allowedTypes.some(type => file.type.startsWith(type));
        if (!isValidType) {
          toast(`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞: ${file.name}`, false);
          return;
        }
      }
      
      if (progWrap) progWrap.classList.remove('hidden');
      
      let pct = 0;
      const t = setInterval(() => {
        pct = Math.min(100, pct + Math.random() * 22);
        
        if (progBar) progBar.style.width = pct + '%';
        if (progPct) progPct.textContent = Math.floor(pct) + '%';
        
        if(pct >= 100){
          clearInterval(t);
          
          try {
            const newFiles = [];
            for (let i = 0; i < files.length; i++) {
              const f = files[i];
              newFiles.unshift(mkFile(
                f.name,
                f.size,
                Math.floor(Math.random() * 900),
                Math.floor(Math.random() * 200),
                +(Math.random() * 150).toFixed(2)
              ));
            }
            
            appData.files = [...newFiles, ...appData.files];
            
            const hist = appData.hist;
            const d = new Date();
            const dateStr = `${d.getDate().toString().padStart(2, '0')}.${(d.getMonth()+1).toString().padStart(2, '0')}.${d.getFullYear()}`;
            
            hist.push({
              date: dateStr,
              source: '–§–∞–π–ª—ã',
              views: Math.floor(Math.random() * 1000 + 200),
              income: +(Math.random() * 120 + 30).toFixed(2)
            });
            
            appData.hist = hist;
            
            renderRecentFiles();
            renderFiles();
            renderSums();
            renderChart();
            renderHistory();
            renderKPIs();
            
            toast('–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
          } catch (error) {
            console.error('Upload error:', error);
            toast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤', false);
          } finally {
            if (progWrap) progWrap.classList.add('hidden');
            if (progBar) progBar.style.width = '0%';
            if (progPct) progPct.textContent = '0%';
            if (fileElem) fileElem.value = '';
          }
        }
      }, 300);
    }
    
    function renderRecentFiles(){
      try {
        const cont = document.getElementById('recent-files');
        if(!cont) return;
        
        cont.innerHTML = '';
        
        appData.files.slice(0, 6).forEach(f => {
          const card = document.createElement('div');
          card.className = 'p-4 bg-white/5 rounded-lg border border-white/10';
          
          const uploadDate = f.uploadedAt ? new Date(f.uploadedAt).toLocaleDateString() : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
          
          card.innerHTML = `
            <div class="font-semibold truncate" title="${f.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}">${f.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
            <div class="text-xs text-white/60">${formatSize(f.size || 0)} ¬∑ ${uploadDate}</div>
            <div class="mt-2 grid grid-cols-3 gap-2 text-center text-sm">
              <div class="bg-white/5 rounded p-2"><div class="font-semibold">${f.views || 0}</div><div class="text-white/60 text-xs">–ü—Ä–æ—Å–º.</div></div>
              <div class="bg-white/5 rounded p-2"><div class="font-semibold">${f.downloads || 0}</div><div class="text-white/60 text-xs">–ó–∞–≥—Ä—É–∑.</div></div>
              <div class="bg-white/5 rounded p-2"><div class="font-semibold">${(f.earnings || 0).toFixed(2)} ‚ÇΩ</div><div class="text-white/60 text-xs">–î–æ—Ö–æ–¥</div></div>
            </div>
            <div class="mt-3 flex flex-wrap gap-2">
              <button class="px-3 py-1.5 rounded-md bg-white/10 hover:bg-white/20" onclick="copy('${f.link || ''}')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
              <button class="px-3 py-1.5 rounded-md bg-red-600/80 hover:bg-red-600" onclick="deleteFile('${f.id || ''}')">–£–¥–∞–ª–∏—Ç—å</button>
            </div>`;
          
          cont.appendChild(card);
        });
      } catch (error) {
        console.error('Error rendering recent files:', error);
      }
    }
    
    // ---------- Files ----------
    function renderFiles(filter = ''){
      try {
        const body = document.getElementById('files-body');
        if(!body) return;
        
        body.innerHTML = '';
        
        const files = appData.files;
        const searchInput = document.getElementById('search-files');
        const q = filter || (searchInput?.value.trim().toLowerCase() || '');
        
        files.filter(f => (f.name || '').toLowerCase().includes(q)).forEach(f => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="px-4 py-2 truncate" title="${f.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}">${f.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</td>
            <td class="px-4 py-2">${formatSize(f.size || 0)}</td>
            <td class="px-4 py-2">${f.views || 0}</td>
            <td class="px-4 py-2">${f.downloads || 0}</td>
            <td class="px-4 py-2">${(f.earnings || 0).toFixed(2)} ‚ÇΩ</td>
            <td class="px-4 py-2 flex flex-wrap gap-2">
              <button class="px-3 py-1 rounded-md bg-white/10 hover:bg-white/20" onclick="copy('${f.link || ''}')">–°—Å—ã–ª–∫–∞</button>
              <button class="px-3 py-1 rounded-md bg-red-600/80 hover:bg-red-600" onclick="deleteFile('${f.id || ''}')">–£–¥–∞–ª–∏—Ç—å</button>
            </td>`;
          body.appendChild(tr);
        });
      } catch (error) {
        console.error('Error rendering files:', error);
      }
    }
    
    const searchFiles = document.getElementById('search-files');
    if (searchFiles) {
      searchFiles.addEventListener('input', e => {
        try {
          renderFiles(e.target.value);
        } catch (error) {
          console.error('Error in search input:', error);
        }
      });
    }
    
    function deleteFile(id){
      try {
        if (!id) {
          toast('–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π ID —Ñ–∞–π–ª–∞', false);
          return;
        }
        
        appData.files = appData.files.filter(f => f.id !== id);
        renderFiles();
        renderRecentFiles();
        renderKPIs();
        toast('–§–∞–π–ª —É–¥–∞–ª—ë–Ω', false);
      } catch (error) {
        console.error('Error deleting file:', error);
        toast('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞', false);
      }
    }
    
    function refreshFiles(){
      try {
        const searchFiles = document.getElementById('search-files');
        if (searchFiles) searchFiles.value = '';
        renderFiles('');
      } catch (error) {
        console.error('Error refreshing files:', error);
        toast('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤', false);
      }
    }
    
    // ---------- Ref ----------
    function renderRef(){
      try {
        const ref = appData.ref;
        const refLink = document.getElementById('ref-link');
        const refClicks = document.getElementById('ref-clicks');
        const refSignups = document.getElementById('ref-signups');
        const refActive = document.getElementById('ref-active');
        const refEarn = document.getElementById('ref-earn');
        
        if (refLink) refLink.value = location.origin + '/?ref=' + (ref.code || '');
        if (refClicks) refClicks.textContent = ref.clicks || 0;
        if (refSignups) refSignups.textContent = ref.signups || 0;
        if (refActive) refActive.textContent = ref.active || 0;
        if (refEarn) refEarn.textContent = (ref.earn || 0).toFixed(2) + ' ‚ÇΩ';
      } catch (error) {
        console.error('Error rendering ref:', error);
      }
    }
    
    function copyRef(){
      try {
        const refLink = document.getElementById('ref-link');
        if (refLink && refLink.value) {
          copy(refLink.value);
        } else {
          toast('–û—à–∏–±–∫–∞: —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', false);
        }
      } catch (error) {
        console.error('Error copying ref link:', error);
        toast('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏', false);
      }
    }
    
    // ---------- Payouts ----------
    function renderPayouts(){
      try {
        const body = document.getElementById('payouts-body');
        if (!body) return;
        
        body.innerHTML = '';
        
        appData.payouts.forEach(p => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td class="px-4 py-2">${p.date || ''}</td>
                          <td class="px-4 py-2">${p.amount || 0} ‚ÇΩ</td>
                          <td class="px-4 py-2">${p.method || ''}</td>
                          <td class="px-4 py-2">${p.status || ''}</td>`;
          body.appendChild(tr);
        });
      } catch (error) {
        console.error('Error rendering payouts:', error);
      }
    }
    
    const formPayout = document.getElementById('form-payout');
    if (formPayout) {
      formPayout.addEventListener('submit', e => {
        e.preventDefault();
        
        if(!requireAuth()) return;
        
        const amountInput = document.getElementById('payout-amount');
        const methodInput = document.getElementById('payout-method');
        const detailsInput = document.getElementById('payout-details');
        
        // Validate inputs
        const isAmountValid = validateInput(amountInput, 'number');
        const isDetailsValid = validateInput(detailsInput, 'text');
        
        if (!isAmountValid || !isDetailsValid) {
          return;
        }
        
        const amt = parseFloat(amountInput.value);
        const method = methodInput.value;
        const det = detailsInput.value.trim();
        
        if(amt < 100) {
          amountInput.classList.add('error');
          const errorEl = document.createElement('div');
          errorEl.className = 'error-message';
          errorEl.textContent = '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 100 ‚ÇΩ';
          amountInput.parentNode.appendChild(errorEl);
          return;
        }
        
        try {
          const d = new Date();
          const dateStr = `${d.getDate().toString().padStart(2, '0')}.${(d.getMonth()+1).toString().padStart(2, '0')}.${d.getFullYear()}`;
          
          appData.payouts.unshift({
            date: dateStr,
            amount: amt,
            method,
            status: '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ'
          });
          
          renderPayouts();
          toast('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
          formPayout.reset();
        } catch (error) {
          console.error('Payout request error:', error);
          toast('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏', false);
        }
      });
    }
    
    // ---------- Support ----------
    function toggleAccordion(el){
      try {
        if (!el) return;
        
        if (el.style.display === 'none' || !el.style.display) {
          el.style.display = 'block';
        } else {
          el.style.display = 'none';
        }
      } catch (error) {
        console.error('Error toggling accordion:', error);
      }
    }
    
    const formSupport = document.getElementById('form-support');
    if (formSupport) {
      formSupport.addEventListener('submit', e => {
        e.preventDefault();
        
        const emailInput = document.getElementById('sup-email');
        const topicInput = document.getElementById('sup-topic');
        const textInput = document.getElementById('sup-text');
        
        // Validate inputs
        const isEmailValid = validateInput(emailInput, 'email');
        const isTextValid = validateInput(textInput, 'text');
        
        if (!isEmailValid || !isTextValid) {
          return;
        }
        
        const email = emailInput.value.trim();
        const topic = topicInput.value;
        const text = textInput.value.trim();
        
        try {
          const d = new Date();
          const dateStr = `${d.getDate().toString().padStart(2, '0')}.${(d.getMonth()+1).toString().padStart(2, '0')}.${d.getFullYear()}`;
          
          appData.tickets.unshift({
            date: dateStr,
            email,
            topic,
            text,
            status: '–ù–æ–≤—ã–π'
          });
          
          toast('–û–±—Ä–∞—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
          formSupport.reset();
        } catch (error) {
          console.error('Support ticket error:', error);
          toast('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è', false);
        }
      });
    }
    
    // ---------- Analytics module ----------
    const anState = { range: '7d', source: 'all', device: 'all', country: 'all' };
    
    function getRangeDates(range){
      const end = new Date();
      end.setHours(23, 59, 59, 999);
      
      const start = new Date(end);
      
      if(range === 'today'){
        start.setHours(0, 0, 0, 0);
      } else if(range === '7d'){
        start.setDate(end.getDate() - 6);
        start.setHours(0, 0, 0, 0);
      } else if(range === '30d'){
        start.setDate(end.getDate() - 29);
        start.setHours(0, 0, 0, 0);
      } else if(range === '90d'){
        start.setDate(end.getDate() - 89);
        start.setHours(0, 0, 0, 0);
      } else {
        start.setDate(end.getDate() - 6);
        start.setHours(0, 0, 0, 0);
      }
      
      return { start, end };
    }
    
    function filterEvents(){
      const ev = appData.events;
      const { start, end } = getRangeDates(anState.range);
      
      return ev.filter(e => {
        const t = new Date(e.ts);
        if(t < start || t > end) return false;
        if(anState.source !== 'all' && e.source !== anState.source) return false;
        if(anState.device !== 'all' && e.device !== anState.device) return false;
        if(anState.country !== 'all' && e.country !== anState.country) return false;
        return true;
      });
    }
    
    function groupByDate(events){
      const map = new Map();
      events.forEach(e => {
        const d = e.ts.slice(0, 10);
        const cur = map.get(d) || { views: 0, dls: 0, earn: 0 };
        
        if(e.type === 'view') cur.views++;
        else if(e.type === 'download'){
          cur.dls++;
          cur.earn += e.income || 0;
        }
        
        map.set(d, cur);
      });
      
      const { start, end } = getRangeDates(anState.range);
      const days = [];
      
      for(let dt = new Date(start); dt <= end; dt.setDate(dt.getDate() + 1)){
        const key = dt.toISOString().slice(0, 10);
        const v = map.get(key) || { views: 0, dls: 0, earn: 0 };
        days.push({ date: key, ...v });
      }
      
      return days;
    }
    
    function groupBy(events, key){
      const map = new Map();
      events.forEach(e => {
        const k = e[key] || 'unknown';
        const cur = map.get(k) || { views: 0, dls: 0, earn: 0 };
        
        if(e.type === 'view') cur.views++;
        else if(e.type === 'download'){
          cur.dls++;
          cur.earn += e.income || 0;
        }
        
        map.set(k, cur);
      });
      
      const arr = Array.from(map, ([name, vals]) => ({ name, ...vals }));
      arr.sort((a, b) => (b.views + b.dls * 3) - (a.views + a.dls * 3));
      return arr;
    }
    
    function computeKPI(events, prevEvents){
      const v = events.filter(e => e.type === 'view').length;
      const d = events.filter(e => e.type === 'download').length;
      const earn = events.reduce((s, e) => s + (e.income || 0), 0);
      const cr = v ? d / v : 0;
      const ecpm = v ? earn / v * 1000 : 0;
      
      const pv = prevEvents.filter(e => e.type === 'view').length;
      const pd = prevEvents.filter(e => e.type === 'download').length;
      const pe = prevEvents.reduce((s, e) => s + (e.income || 0), 0);
      
      function delta(cur, prev){
        if(prev === 0 && cur > 0) return { sign: 'up', val: 100 };
        if(prev === 0) return { sign: 'up', val: 0 };
        
        const diff = (cur - prev) / prev * 100;
        return { sign: diff >= 0 ? 'up' : 'down', val: Math.abs(diff) };
      }
      
      return {
        views: v,
        dls: d,
        earn,
        cr,
        ecpm,
        dViews: delta(v, pv),
        dDls: delta(d, pd),
        dCr: delta(cr, prevEvents.length ? (pd / pv) || 0 : 0),
        dEarn: delta(earn, pe)
      };
    }
    
    function drawLineChart(canvas, labels, seriesA, seriesB){
      if (!canvas) return;
      
      const dpr = window.devicePixelRatio || 1;
      const ctx = canvas.getContext('2d');
      const W = canvas.clientWidth;
      const H = canvas.clientHeight;
      
      canvas.width = W * dpr;
      canvas.height = H * dpr;
      ctx.scale(dpr, dpr);
      
      ctx.clearRect(0, 0, W, H);
      
      const pad = { l: 32, r: 10, t: 10, b: 24 };
      const max = Math.max(1, ...seriesA, ...seriesB);
      
      const xStep = (W - pad.l - pad.r) / Math.max(1, labels.length - 1);
      
      function y(v){
        return H - pad.b - (v / max) * (H - pad.t - pad.b);
      }
      
      function x(i){
        return pad.l + i * xStep;
      }
      
      // grid
      ctx.strokeStyle = 'rgba(255,255,255,.12)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      
      for(let i = 0; i <= 4; i++){
        const gy = pad.t + i * (H - pad.t - pad.b) / 4;
        ctx.moveTo(pad.l, gy);
        ctx.lineTo(W - pad.r, gy);
      }
      
      ctx.stroke();
      
      // area A
      ctx.beginPath();
      ctx.moveTo(x(0), y(seriesA[0] || 0));
      
      for(let i = 1; i < labels.length; i++){
        ctx.lineTo(x(i), y(seriesA[i] || 0));
      }
      
      ctx.lineTo(x(labels.length - 1), H - pad.b);
      ctx.lineTo(x(0), H - pad.b);
      ctx.closePath();
      
      const gradA = ctx.createLinearGradient(0, pad.t, 0, H - pad.b);
      gradA.addColorStop(0, 'rgba(96,165,250,.35)');
      gradA.addColorStop(1, 'rgba(96,165,250,.05)');
      
      ctx.fillStyle = gradA;
      ctx.fill();
      
      // line A
      ctx.beginPath();
      ctx.moveTo(x(0), y(seriesA[0] || 0));
      
      for(let i = 1; i < labels.length; i++){
        ctx.lineTo(x(i), y(seriesA[i] || 0));
      }
      
      ctx.strokeStyle = '#60a5fa';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // line B
      ctx.beginPath();
      ctx.moveTo(x(0), y(seriesB[0] || 0));
      
      for(let i = 1; i < labels.length; i++){
        ctx.lineTo(x(i), y(seriesB[i] || 0));
      }
      
      ctx.strokeStyle = '#34d399';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // x labels (sparse)
      ctx.fillStyle = 'rgba(255,255,255,.65)';
      ctx.font = '12px Inter, system-ui, sans-serif';
      
      const step = Math.ceil(labels.length / 6);
      
      labels.forEach((lab, i) => {
        if(i % step === 0 || i === labels.length - 1){
          ctx.fillText(lab.slice(5).replace('-', '.'), x(i) - 10, H - 6);
        }
      });
    }
    
    function drawDonut(canvas, slices){
      if (!canvas) return;
      
      const dpr = window.devicePixelRatio || 1;
      const ctx = canvas.getContext('2d');
      const W = canvas.clientWidth;
      const H = canvas.clientHeight;
      
      canvas.width = W * dpr;
      canvas.height = H * dpr;
      ctx.scale(dpr, dpr);
      
      ctx.clearRect(0, 0, W, H);
      
      const cx = W / 2;
      const cy = H / 2;
      const R = Math.min(W, H) / 2 - 6;
      const r = R * 0.58;
      
      const colors = ['#60a5fa', '#34d399', '#f59e0b', '#a78bfa', '#f87171', '#22d3ee', '#93c5fd'];
      
      const total = slices.reduce((s, x) => s + x.value, 0) || 1;
      let a0 = -Math.PI / 2;
      
      slices.forEach((s, i) => {
        const a1 = a0 + 2 * Math.PI * (s.value / total);
        
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.arc(cx, cy, R, a0, a1);
        ctx.closePath();
        
        ctx.fillStyle = colors[i % colors.length] + 'cc';
        ctx.fill();
        
        a0 = a1;
      });
      
      // hole
      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(cx, cy, r, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.globalCompositeOperation = 'source-over';
      
      // center label
      ctx.fillStyle = 'rgba(255,255,255,.85)';
      ctx.font = 'bold 14px Inter';
      ctx.textAlign = 'center';
      ctx.fillText(total.toLocaleString('ru-RU') + ' –≤–∏–∑–∏—Ç–æ–≤', cx, cy + 4);
    }
    
    function drawBars(canvas, items){
      if (!canvas) return;
      
      const dpr = window.devicePixelRatio || 1;
      const ctx = canvas.getContext('2d');
      const W = canvas.clientWidth;
      const H = canvas.clientHeight;
      
      canvas.width = W * dpr;
      canvas.height = H * dpr;
      ctx.scale(dpr, dpr);
      
      ctx.clearRect(0, 0, W, H);
      
      const pad = { l: 90, r: 10, t: 10, b: 10 };
      const barH = 18;
      const gap = 10;
      
      const max = Math.max(1, ...items.map(i => i.value));
      
      items.slice(0, 8).forEach((it, idx) => {
        const x = pad.l;
        const y = pad.t + idx * (barH + gap);
        const w = (W - pad.l - pad.r) * (it.value / max);
        
        const grad = ctx.createLinearGradient(x, y, x + w, y);
        grad.addColorStop(0, '#8b5cf6');
        grad.addColorStop(1, '#22d3ee');
        
        ctx.fillStyle = grad;
        ctx.fillRect(x, y, w, barH);
        
        ctx.fillStyle = 'rgba(255,255,255,.85)';
        ctx.font = '12px Inter';
        ctx.textAlign = 'right';
        ctx.fillText(it.value.toLocaleString('ru-RU'), x + w + 36, y + barH - 4);
        
        ctx.textAlign = 'left';
        ctx.fillStyle = 'rgba(255,255,255,.75)';
        ctx.fillText(it.name, 8, y + barH - 4);
      });
    }
    
    function drawSpark(canvas, series){
      if (!canvas) return;
      
      const dpr = window.devicePixelRatio || 1;
      const ctx = canvas.getContext('2d');
      const W = canvas.clientWidth;
      const H = canvas.clientHeight;
      
      canvas.width = W * dpr;
      canvas.height = H * dpr;
      ctx.scale(dpr, dpr);
      
      ctx.clearRect(0, 0, W, H);
      
      const max = Math.max(1, ...series);
      const step = W / Math.max(1, series.length - 1);
      
      ctx.beginPath();
      ctx.moveTo(0, H - (series[0] / max) * H);
      
      for(let i = 1; i < series.length; i++){
        ctx.lineTo(i * step, H - (series[i] / max) * H);
      }
      
      ctx.strokeStyle = '#8b5cf6';
      ctx.lineWidth = 2;
      ctx.stroke();
    }
    
    function seedEventsIfEmpty(){
      try {
        if (appData.events.length > 0) return;
        
        const files = appData.files;
        const refDomains = ['twitter.com', 'vk.com', 'youtube.com', 't.me', 'discord.gg', 'habr.com', 'direct'];
        const countries = ['RU', 'BY', 'UA', 'KZ', 'PL', 'DE', 'US', 'IN'];
        const devices = ['desktop', 'mobile', 'mobile', 'desktop', 'tablet', 'bot'];
        const sources = ['files', 'links', 'ref', 'files', 'files', 'links'];
        
        const events = [];
        const days = 30;
        
        for(let d = days - 1; d >= 0; d--){
          const date = new Date();
          date.setDate(date.getDate() - d);
          const day = date.toISOString().slice(0, 10);
          
          const perDay = Math.floor(80 + Math.random() * 140);
          
          for(let i = 0; i < perDay; i++){
            const f = files.length ? files[Math.floor(Math.random() * files.length)] : { id: 'nofile', name: '–ü—Ä–∏–º–µ—Ä', size: 1234 };
            const device = devices[Math.floor(Math.random() * devices.length)];
            const source = sources[Math.floor(Math.random() * sources.length)];
            const ref = refDomains[Math.floor(Math.random() * refDomains.length)];
            const country = countries[Math.floor(Math.random() * countries.length)];
            
            const isDownload = Math.random() < 0.18;
            const income = isDownload ? +(Math.random() * 2.0).toFixed(2) : 0;
            
            events.push({
              ts: new Date(day + 'T' + String(Math.floor(Math.random() * 24)).padStart(2, '0') + ':' + String(Math.floor(Math.random() * 60)).padStart(2, '0') + ':00Z').toISOString(),
              type: isDownload ? 'download' : 'view',
              fileId: f.id,
              fileName: f.name,
              device,
              source,
              ref,
              country,
              income
            });
          }
        }
        
        appData.events = events;
      } catch (error) {
        console.error('Error seeding events:', error);
        appData.events = [];
      }
    }
    
    function renderAnalytics(){
      try {
        seedEventsIfEmpty();
        
        // populate countries dropdown once
        const selCountry = document.getElementById('an-country');
        if(selCountry && selCountry.options.length <= 1){
          const countries = Array.from(new Set(appData.events.map(e => e.country || '').filter(c => c))).sort();
          
          countries.forEach(c => {
            const o = document.createElement('option');
            o.value = c;
            o.textContent = c;
            selCountry.appendChild(o);
          });
        }
      
      const ev = filterEvents();
      
      // previous period
      const lenDays = groupByDate(ev).length || 7;
      const all = appData.events;
      
      const { start } = getRangeDates(anState.range);
      const prevEnd = new Date(start);
      prevEnd.setDate(prevEnd.getDate() - 1);
      
      const prevStart = new Date(prevEnd);
      prevStart.setDate(prevStart.getDate() - (lenDays - 1));
      prevStart.setHours(0, 0, 0, 0);
      
      const prevEv = all.filter(e => {
        const t = new Date(e.ts);
        return t >= prevStart && t <= prevEnd;
      });
      
      const kpi = computeKPI(ev, prevEv);
      
      // KPI
      const anKpiViews = document.getElementById('an-kpi-views');
      const anKpiDls = document.getElementById('an-kpi-dls');
      const anKpiCr = document.getElementById('an-kpi-cr');
      const anKpiEarn = document.getElementById('an-kpi-earn');
      const anKpiEcpm = document.getElementById('an-kpi-ecpm');
      
      if (anKpiViews) anKpiViews.textContent = fmt(kpi.views);
      if (anKpiDls) anKpiDls.textContent = fmt(kpi.dls);
      if (anKpiCr) anKpiCr.textContent = (kpi.cr * 100).toFixed(1) + '%';
      if (anKpiEarn) anKpiEarn.textContent = kpi.earn.toFixed(2) + ' ‚ÇΩ';
      if (anKpiEcpm) anKpiEcpm.textContent = 'eCPM: ' + kpi.ecpm.toFixed(2) + ' ‚ÇΩ';
      
      function setDelta(id, d){
        const el = document.getElementById(id);
        if (!el) return;
        
        el.textContent = (d.sign === 'up' ? '‚ñ≤ ' : '‚ñº ') + d.val.toFixed(1) + '%';
        el.className = 'delta ' + d.sign;
      }
      
      setDelta('an-kpi-views-delta', kpi.dViews);
      setDelta('an-kpi-dls-delta', kpi.dDls);
      setDelta('an-kpi-cr-delta', kpi.dCr);
      
      // Charts
      const byDay = groupByDate(ev);
      
      const chartTraffic = document.getElementById('chart-traffic');
      if (chartTraffic) {
        drawLineChart(
          chartTraffic,
          byDay.map(d => d.date),
          byDay.map(d => d.views),
          byDay.map(d => d.dls)
        );
      }
      
      const byDev = groupBy(ev, 'device').map(x => ({ name: x.name, value: x.views + x.dls }));
      
      const chartDevices = document.getElementById('chart-devices');
      if (chartDevices) {
        drawDonut(chartDevices, byDev);
      }
      
      const legendDev = document.getElementById('legend-dev');
      if (legendDev) {
        legendDev.innerHTML = '';
        
        byDev.slice(0, 5).forEach((d, i) => {
          const span = document.createElement('span');
          span.innerHTML = `<span class="dot" style="background:${['#60a5fa','#34d399','#f59e0b','#a78bfa','#f87171'][i%5]}"></span>${d.name} (${fmt(d.value)})`;
          legendDev.appendChild(span);
        });
      }
      
      const bySrc = groupBy(ev, 'source').map(x => ({ name: x.name, value: x.views + x.dls }));
      
      const chartSources = document.getElementById('chart-sources');
      if (chartSources) {
        drawBars(chartSources, bySrc);
      }
      
      const byCountry = groupBy(ev, 'country').map(x => ({ name: x.name, value: x.views + x.dls }));
      
      const chartCountries = document.getElementById('chart-countries');
      if (chartCountries) {
        drawBars(chartCountries, byCountry);
      }
      
      // Top files
      const filesAgg = groupBy(ev, 'fileName').map(x => ({ name: x.name, views: x.views, dls: x.dls, earn: x.earn }));
      filesAgg.sort((a, b) => b.views - a.views);
      
      const tbodyF = document.getElementById('an-top-files');
      if (tbodyF) {
        tbodyF.innerHTML = '';
        
        filesAgg.slice(0, 10).forEach(f => {
          const tr = document.createElement('tr');
          
          const ctr = f.views ? (f.dls / f.views * 100) : 0;
          
          tr.innerHTML = `<td class="truncate" title="${f.name}">${f.name}</td>
            <td>${fmt(f.views)}</td>
            <td>${fmt(f.dls)}</td>
            <td>${ctr.toFixed(1)}%</td>
            <td>${f.earn.toFixed(2)} ‚ÇΩ</td>
            <td><canvas class="spark"></canvas></td>`;
          
          tbodyF.appendChild(tr);
          
          const s = groupByDate(ev.filter(e => e.fileName === f.name)).map(d => d.views + d.dls * 1.5);
          
          const sparkCanvas = tr.querySelector('canvas');
          if (sparkCanvas) {
            drawSpark(sparkCanvas, s);
          }
        });
      }
      
      // Top referrers
      const refAgg = groupBy(ev, 'ref');
      
      const tbodyR = document.getElementById('an-top-ref');
      if (tbodyR) {
        tbodyR.innerHTML = '';
        
        refAgg.slice(0, 10).forEach(r => {
          const conv = r.views ? (r.dls / r.views * 100) : 0;
          
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${r.name}</td>
            <td>${fmt(r.views)}</td>
            <td>${fmt(r.dls)}</td>
            <td>${conv.toFixed(1)}%</td>`;
          
          tbodyR.appendChild(tr);
        });
      }
      
      // Events feed
      const feed = document.getElementById('an-events');
      if (feed) {
        const last = ev.slice(-200).reverse();
        feed.innerHTML = '';
        
        last.slice(0, 50).forEach(e => {
          const row = document.createElement('div');
          row.className = 'flex items-center justify-between gap-3 p-2 rounded-md bg-white/5 border border-white/10';
          
          const badge = e.type === 'download' ?
            '<span class="tag" style="background:#064e3b;border-color:#065f46;color:#a7f3d0">download</span>' :
            '<span class="tag" style="background:#0c4a6e;border-color:#0369a1;color:#bae6fd">view</span>';
          
          row.innerHTML = `
            <div class="flex items-center gap-2">
              ${badge}
              <div class="text-sm">${e.fileName || '‚Äî'}</div>
            </div>
            <div class="flex items-center gap-3 text-xs text-white/70">
              <span class="pill">${e.source}</span>
              <span class="pill">${e.ref}</span>
              <span class="pill">${e.device}</span>
              <span class="pill">${e.country}</span>
              ${e.income ? `<span class="pill">+${e.income.toFixed(2)} ‚ÇΩ</span>` : ''}
              <span>${new Date(e.ts).toLocaleString()}</span>
            </div>`;
          
          feed.appendChild(row);
        });
        
        const anEventsCount = document.getElementById('an-events-count');
        if (anEventsCount) {
          anEventsCount.textContent = `${last.length} —Å–æ–±—ã—Ç–∏–π`;
        }
      }
      } catch (error) {
        console.error('Error rendering analytics:', error);
        toast('–û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏', false);
      }
    }
    
    function bindAnalyticsUI(){
      try {
        document.querySelectorAll('#analytics [data-range]').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('#analytics [data-range]').forEach(b => {
              b.classList.remove('btn-primary');
            });
            
            btn.classList.add('btn-primary');
            anState.range = btn.dataset.range;
            renderAnalytics();
          });
        });
        
        const defBtn = document.querySelector(`#analytics [data-range="${anState.range}"]`);
        if(defBtn) defBtn.classList.add('btn-primary');
        
        const anSource = document.getElementById('an-source');
        if (anSource) {
          anSource.addEventListener('change', e => {
            anState.source = e.target.value;
            renderAnalytics();
          });
        }
        
        const anDevice = document.getElementById('an-device');
        if (anDevice) {
          anDevice.addEventListener('change', e => {
            anState.device = e.target.value;
            renderAnalytics();
          });
        }
        
        const anCountry = document.getElementById('an-country');
        if (anCountry) {
          anCountry.addEventListener('change', e => {
            anState.country = e.target.value;
            renderAnalytics();
          });
        }
        
        const anExport = document.getElementById('an-export');
        if (anExport) {
          anExport.addEventListener('click', () => {
            try {
              const ev = filterEvents();
              const headers = ['ts', 'type', 'fileName', 'device', 'source', 'ref', 'country', 'income'];
              
              const rows = ev.map(e => 
                headers.map(h => `"${String(e[h] ?? '').replace(/"/g, '""')}"`).join(',')
              );
              
              const csv = [headers.join(','), ...rows].join('\n');
              const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
              
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'analytics.csv';
              
              a.click();
              URL.revokeObjectURL(url);
              
              toast('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω');
            } catch (error) {
              console.error('Export error:', error);
              toast('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞', false);
            }
          });
        }
        
        const anSim = document.getElementById('an-sim');
        if (anSim) {
          anSim.addEventListener('click', () => {
            try {
              simulateTraffic(200 + Math.floor(Math.random() * 250));
              renderAnalytics();
              toast('–¢—Ä–∞—Ñ–∏–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
            } catch (error) {
              console.error('Traffic simulation error:', error);
              toast('–û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞', false);
            }
          });
        }
      } catch (error) {
        console.error('Error binding analytics UI:', error);
      }
    }
    
    // ---- –°–∏–º—É–ª—è—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞ (–¥–µ–º–æ) ----
    function simulateTraffic(n = 250){
      try {
        const files = appData.files;
        const refDomains = ['twitter.com', 'vk.com', 'youtube.com', 't.me', 'discord.gg', 'habr.com', 'direct', 'reddit.com', 'instagram.com'];
        const countries = ['RU', 'BY', 'UA', 'KZ', 'PL', 'DE', 'US', 'IN', 'BR', 'TR', 'FR', 'IT'];
        const devices = ['desktop', 'mobile', 'mobile', 'desktop', 'tablet', 'bot'];
        const sources = ['files', 'links', 'ref', 'files', 'links', 'files'];
        
        const events = [...appData.events];
        const now = Date.now();
        
        const { start, end } = getRangeDates(anState.range);
        const spanDays = Math.floor((end - start) / (1000 * 60 * 60 * 24));
        
        for(let i = 0; i < n; i++){
          const f = files.length ? files[Math.floor(Math.random() * files.length)] : { id: 'nofile', name: '–ú–∞—Ç–µ—Ä–∏–∞–ª ' + (i % 7 + 1) };
          const device = devices[Math.floor(Math.random() * devices.length)];
          const source = sources[Math.floor(Math.random() * sources.length)];
          const ref = refDomains[Math.floor(Math.random() * refDomains.length)];
          const country = countries[Math.floor(Math.random() * countries.length)];
          
          const isDownload = Math.random() < 0.2;
          const income = isDownload ? +(Math.random() * 2.5).toFixed(2) : 0;
          
          // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
          const randomTime = start.getTime() + Math.random() * (end.getTime() - start.getTime());
          const ts = new Date(randomTime).toISOString();
          
          events.push({
            ts,
            type: isDownload ? 'download' : 'view',
            fileId: f.id,
            fileName: f.name,
            device,
            source,
            ref,
            country,
            income
          });
        }
        
        appData.events = events;
      } catch (error) {
        console.error('Error simulating traffic:', error);
        toast('–û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞', false);
      }
    }
    
    // ---- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ----
    document.addEventListener('DOMContentLoaded', () => {
      try {
        // Mobile menu event listeners
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        if (mobileMenuBtn) {
          mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        }
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
          try {
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            
            if (mobileMenu && mobileMenuBtn && 
                !mobileMenu.contains(e.target) && 
                !mobileMenuBtn.contains(e.target)) {
              if (!mobileMenu.classList.contains('hidden')) {
                toggleMobileMenu();
              }
            }
          } catch (error) {
            console.error('Error handling click outside mobile menu:', error);
          }
        });
        
        // —Å–∏–¥—ã –∏ UI
        seedIfEmpty();
        initAuthUI();
        
        renderKPIs();
        renderSums();
        renderChart();
        renderHistory();
        
        renderRecentFiles();
        renderFiles();
        renderPayouts();
        renderRef();
        
        // –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
        bindAnalyticsUI();
        renderAnalytics();
        
        // –≤–∫–ª—é—á–∞–µ–º .reveal –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞, –µ—Å–ª–∏ –Ω–µ –¥–æ–∂–¥–∞–ª–∏—Å—å observer
        document.querySelectorAll('section.active .reveal').forEach(el => {
          try {
            el.classList.add('visible');
          } catch (error) {
            console.error('Error setting reveal visible:', error);
          }
        });
        
        // Add loading states to forms
        addFormLoadingStates();
        
      } catch (error) {
        console.error('Error during app initialization:', error);
        toast('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', false);
      }
    });
    
    // ---------- Form loading states ----------
    function addFormLoadingStates() {
      const forms = document.querySelectorAll('form');
      
      forms.forEach(form => {
        const submitBtn = form.querySelector('button[type="submit"], button:not([type])');
        
        if (submitBtn) {
          form.addEventListener('submit', () => {
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            
            // Re-enable after a delay (simulating form submission)
            setTimeout(() => {
              submitBtn.disabled = false;
              submitBtn.classList.remove('loading');
            }, 2000);
          });
        }
      });
    }
    
    // ---------- Input validation ----------
    function validateInput(input, type = 'text') {
      const value = input.value.trim();
      let isValid = true;
      let errorMessage = '';
      
      // Remove previous error state
      input.classList.remove('error');
      const existingError = input.parentNode.querySelector('.error-message');
      if (existingError) {
        existingError.remove();
      }
      
      switch (type) {
        case 'email':
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          isValid = emailRegex.test(value);
          errorMessage = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email';
          break;
        case 'password':
          isValid = value.length >= 6;
          errorMessage = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
          break;
        case 'number':
          isValid = !isNaN(value) && value > 0;
          errorMessage = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ';
          break;
        default:
          isValid = value.length > 0;
          errorMessage = '–≠—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è';
      }
      
      if (!isValid) {
        input.classList.add('error');
        const errorEl = document.createElement('div');
        errorEl.className = 'error-message';
        errorEl.textContent = errorMessage;
        input.parentNode.appendChild(errorEl);
      }
      
      return isValid;
    }
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫
    window.addEventListener('error', (e) => {
      console.error('App error:', e.error || e.message || e);
      try {
        toast('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å', false);
      } catch {}
    });
    
    window.addEventListener('unhandledrejection', (e) => {
      console.error('Unhandled promise:', e.reason || e);
      try {
        toast('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å', false);
      } catch {}
    });
  </script>
</body>
</html>